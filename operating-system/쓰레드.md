 # 쓰레드

### 정의
쓰레드는 프로세스 내에서 실행되는 가장 작은 단위이다. 프로세스가 운영체제로부터 자원을 받아 실행되는 프로그램의 단위라면, 쓰레드는 그 프로세스 내에서 실질적인 연산을 수행하는 실행 단위다. 하나의 프로세스는 여러 쓰레드를 가질 수 있으며, 이 쓰레드들은 동일한 메모리 공간을 공유하며 실행된다.

### 멀티 프로세스와 멀티 쓰레드
쓰레드와 프로세스는 모두 독립적으로 실행될 수 있지만, **멀티 프로세스**와 **멀티 쓰레드**는 중요한 차이점을 가진다.

- **멀티 프로세스**: 각 프로세스는 독립된 주소 공간을 가지며, 서로 데이터를 공유하지 않는다. 각 프로세스 간의 통신은 `IPC(Inter-Process Communication)` 같은 방법을 통해 이루어진다.
  
- **멀티 쓰레드**: 여러 쓰레드는 하나의 프로세스 내에서 실행되며, **주소 공간을 공유**한다. 이는 쓰레드들이 데이터를 쉽게 공유할 수 있음을 의미하며, 성능적으로도 유리하다.  
  특히, **컨텍스트 스위칭(Context Switch)** 시, 프로세스는 서로 다른 주소 공간을 참조해야 하지만, 쓰레드는 같은 주소 공간을 참조하기 때문에 컨텍스트 스위칭 비용이 적고, **더 빠르게 작업을 처리**할 수 있다. 멀티 쓰레드는 이러한 이유로 멀티 프로세스보다 **더 효율적인 메모리 사용과 성능**을 보인다.

### 문제점
쓰레드는 성능적인 이점을 제공하지만, **동일한 주소 공간을 공유**하기 때문에 여러 쓰레드가 동시에 데이터에 접근하는 상황에서 문제가 발생할 수 있다.

#### 경쟁 조건 (Race Condition)
경쟁 조건은 **명령어의 실행 순서에 따라 결과가 달라지는 상황**을 의미한다. 구체적으로 **데이터 경쟁**(Data Race)이라고도 하며, 여러 쓰레드가 동일한 데이터에 동시에 접근하고, 그 결과 데이터의 일관성이 깨질 수 있는 상황을 말한다.

예를 들어, 두 쓰레드가 동시에 같은 변수를 읽고 쓸 때, 하나의 쓰레드가 데이터를 변경하는 동안 다른 쓰레드가 이 데이터를 읽으면 예상치 못한 결과가 발생할 수 있다.

#### 임계 영역(Critical Section)
경쟁 조건이 발생할 수 있는 코드 영역을 **임계 영역**이라고 한다. 이곳에서는 여러 쓰레드가 동시에 접근하지 못하도록 관리해야 하며, 그렇지 않으면 데이터 무결성 문제가 발생할 수 있다.

### 해결책: 상호 배제(Mutual Exclusion)
경쟁 조건을 방지하기 위한 방법으로 **상호 배제(Mutual Exclusion)**가 있다. 상호 배제는 **하나의 쓰레드가 임계 영역에 진입하여 코드를 실행하는 동안 다른 쓰레드가 해당 영역에 진입하지 못하도록 보장**하는 속성이다. 이를 통해 쓰레드 간의 동시 접근을 제어하고, 데이터 일관성을 유지할 수 있다.

상호 배제를 구현하는 대표적인 방법들은 다음과 같다:
- **Mutex(뮤텍스)**: 하나의 쓰레드만 임계 영역에 접근하도록 보장하는 동기화 객체.
- **Semaphore(세마포어)**: 지정된 수만큼의 쓰레드가 임계 영역에 진입할 수 있게 허용하는 동기화 도구.
- **Lock(락)**: 쓰레드가 임계 영역에 진입할 때 락을 걸어 다른 쓰레드가 접근하지 못하게 함.
